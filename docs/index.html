<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="prettify_theme.css">
  <link rel="stylesheet" href="style.css">
  <title>ABC Project</title>
</head>
<body>
<script src="//rawgit.com/marpple/abc-functional-javascript/master/etc/abc.all.js"></script>
<script src="//code.jquery.com/jquery-2.2.4.min.js"></script>
<!--<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>-->
<script src="//rawgit.com/marpple/abc-functional-javascript/master/example/js/underscore.js"></script>
<script src="//cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
<script>
  /*Functions List variable declaration*/
  var funcs = _.filter(_.keys(F), function(val) { return val !== 'F' && val !== 'G' });

  /*Section Data declaration*/
  var section_data = {
    A : {
      func : {
        title : 'A',
        usage : 'A()',
        egs : [{
          ds: '`A`는 `apply`와 비슷합니다. 배열이나 객체를 사용할 수 있습니다.',
          cd: '\
                  |function add(a, b) {\
                  |__return a + b; \
                  |}\
                  |\
                  |var r1 = A([20,2], add);\
                  |console.log(r1); // 22'}, {
          ds : '왼쪽에서 오른쪽, 위에서 아래로 읽는게 편안합니다. 그래서 `A`는 인자와 함수 사용에 대한 방향을 바꾸었습니다.',
          cd : '\
                  |function minus(a, b) {\
                  |__return a - b;\
                  |}\
                  |\
                  |var r2 = A([20, 5], function() {\
                  |__return A(arguments, minus);\
                  |});\
                  |console.log(r2); // 15'}]
      },
      methods: {}
    },
    B : {
      func : {
        title : 'B',
        usage : 'B()',
        egs : [{
          ds: '`B`는 `this`를 제외한 `bind`라고 생각하면 쉽습니다. 혹은 underscore의 `_.partial`과 유사합니다.',
          cd: '\
                  |var f2 = B(X, 10, minus);\
                  |var r2 = f2(20);\
                  |\
                  |console.log(r2); // 10\
                  |\
                  |function minus2(a, b, c, d) {\
                  |__return a - b - c - d;\
                  |}\
                  |\
                  |var f3 = B(4, X, X, 1, minus2);\
                  |var r3 = f3(3, 2);\
                  |console.log(r3); // -2'}, {
          ds : '`B`를 `X`와 함께 사용해보세요. `X`를 통해 이후 실행시에 받게될 인자의 자리를 지정해둘 수 있습니다.',
          cd : '\
                  |var f2 = B(X, 10, minus);\
                  |var r2 = f2(20);\
                  |\
                  |console.log(r2); // 10\
                  |\
                  |function minus2(a, b, c, d) {\
                  |__return a - b - c - d;\
                  |}\
                  |\
                  |var f3 = B(4, X, X, 1, minus2);\
                  |var r3 = f3(3, 2);\
                  |console.log(r3); // -2'}]
      },
      methods: {
        args : {
          title : 'args',
          usage : 'B.args(index)(v1, v2 ...)',
          egs : [{
            ds: '`B.args`는 인덱스 값에 맞춰 매개변수의 값을 반환하는 함수를 만듭니다.',
            cd: '\
                  |var arg0 = B.args(0);\
                  |var r1 = arg0(10, 20, 30);\
                  |console.log(r1); // 10\
                  |\
                  |var arg3 = B.args(3);\
                  |var r2 = arg3(10, 20, 30, 40);\
                  |console.log(r2); // 40\
                  |\
                  |var arg0_3 = B.args(0, 3);\
                  |var r3 = arg0_3(10, 20, 30, 40);\
                  |console.log(r3); // [10, 40]\
                  |\
                  |C(\'hi\', 10, 20, [B.args(1, 2), function(a, b) { return a + b; }]);\
                  |var keys = B.map([B.args(1), I]);\
                  |var values = B.map([B.args(0), I]);'}]
        },
        remove : {
          title : 'remove',
          usage : 'B.remove(target)(array)',
          egs : [{
            ds: '`B.remove`는 매개변수로 전달된 배열 중에서 최초로 발견한 값 하나를 제거하는 함수를 만듭니다.',
            cd: '\
                  |var r1 = C([10, 20, 30], [B.remove(10), B.args(2)]);\
                  |console.log(r1); // [20, 30]'}]
        },
        unset : {
          title : 'unset',
          usage : 'B.unset()',
          egs : [{
            ds: '`B.unset`은 뭐하는거야?',
            cd: '\
                  |-----------------------------------\
                  |-----------------------------------'}]
        },
        set : {
          title : 'set',
          usage : 'B.set()',
          egs : [{
            ds: '`B.set`은 뭐하는거야?',
            cd: '\
                  |-----------------------------------\
                  |-----------------------------------'}]
        },
        extend : {
          title : 'extend',
          usage : 'B.extend()',
          egs : [{
            ds: '`B.extend`은 뭐하는거야?',
            cd: '\
                  |-----------------------------------\
                  |-----------------------------------'}]
        },
        defaults : {
          title : 'defaults',
          usage : 'B.defaults()',
          egs : [{
            ds: '`B.defauls`은 뭐하는거야?',
            cd: '\
                  |-----------------------------------\
                  |-----------------------------------'}]
        },
        select : {
          title : 'select',
          usage : 'B.select()',
          egs : [{
            ds: '`B.select`은 뭐하는거야?',
            cd: '\
                  |-----------------------------------\
                  |-----------------------------------'}]
        }

      }
    },
    H : {
      func : {
        title : 'H',
        usage : 'H("var name...", H template code)(args)',
        egs : [{
          ds: "이 `H`함수는 ~하는 함수 입니다.",
          cd: "\
                  |function() {\
                  |__return arguments;\
                  |}"}, {
          ds : "이렇게도 사용할 수 있습니다.",
          cd : "\
                  |function() {\
                  |__return arguments[0];\
                  |}"}]
      },
      methods: {
        TAB_SIZE :
        {
          title : 'TAB_SIZE',
          usage : 'H.TAB_SIZE()',
          egs : [{
            ds: "이 함수는 ~하는 함수 입니다.",
            cd: "\
                  |function() {\
                  |__return arguments;\
                  |}"}]
        },
        each :
        {
          title : 'each',
          usage : 'H.each()',
          egs : [{
            ds: "이 `H.each`함수는 ~하는 함수 입니다.",
            cd: "\
                  |function() {\
                  |__return arguments;\
                  |}"}, {
            ds : "이렇게도 사용할 수 있습니다.",
            cd : "\
                  |function() {\
                  |__return arguments[0];\
                  |}"}]
        }
      }
    }
  };

  /*HTML Rendering*/
  C(funcs, [H('funcs','\
    div.bar#bar_wrapper\
      div#logo\
        h3 ABC JS \
          br\
          small Functional JavaScript\
      div#list_bar\
        div.input-group\
          input.form-control#search[type=text placeholder=Search]\
          span.input-group-addon\
            span.glyphicon.glyphicon-search\
        ul.func_list\
          {{{C(funcs, ', H.each('func', '\
          li[data=!{func}!]\
            h4\
              a[href=#!{func}!] !{func}!\
            ul.method_list.!{func}!\
              {{{C(_.keys(!{func}!), "!{func}!", ', H.each("method, k, l, func", '\
              li[data=!{method}!]\
                a[href=#!{func}!_!{method}!] !{method}!'), ')}}}'
  ),')}}}\
      div#about_us\
        p Mapple ©\
        ul\
          li\
            a[href=http://www.marpple.com] Marpple\
          li\
            a[href=https://github.com/marpple/abc-functional-javascript] Repository\
    div.container\
      div#section_container\
          {{{C(G.sections = section_bulider(section_data), ', H.each("section", "\
           div {{{H('', replace_(section))()}}}\
          "), ')}}}\
    '),
    $,
    B.M('appendTo', 'body')]);


  /*General functions*/
  function section_bulider(temp_section) {
    return _.map(_.keys(temp_section), function(key) {

      var section_values = _.values(temp_section[key]);
      var func = section_values[0],
          methods = section_values[1];

      return ['\
            div.outer_section#'+key+'\
              h3.func_title '+func.title+' \
                small '+func.usage+'\
              p '+func.egs[0].ds+'\
              pre.prettyprint\
                '+func.egs[0].cd+'\
              p '+func.egs[1].ds+'\
              pre.prettyprint\
                '+func.egs[1].cd]
          .concat(_.map(methods, function(method) {
            return ['\
              div.inner_section#'+key+'_'+method.title+'\
                h4.method_title '+key+'.'+method.title+' \
                  small '+method.usage]
                .concat(_.map(method.egs, function(eg) {
                  return ['\
                p '+eg.ds+'\
                pre.prettyprint\
                  '+eg.cd]
                })).join('');
          })).join('');
    });
  }

  function replace_(str) {
    return str.replace(/\|(_+)/g, function(m, u) { return "|" + u.replace(/_/g, '&nbsp;'); }).replace(/`(.*?)`/g, '<code>$1</code>');
  }

  function update_section_list(str) {
    if (!str) return $('#list_bar li').show();

    var reg = new RegExp(str, "i");

    var $func_li = _.filter($('ul.func_list > li'), function(func){
      return $(func).attr('data').match(reg) ? !$('ul.func_list li').show() : true;
    });

    var res = _.map($func_li, function(li) { //메소드 조사
      var $li = $(li);
      return li.innerText.match(reg) ? (function() {
        $li.show();
        return $li.children('ul')[0].childNodes; })() : $li.hide();
    });

    _.each(res, function(li) {
      if (li) {
        _.each(li, function (inner_li) { return inner_li.innerText.match(reg) ? $(inner_li).show() : $(inner_li).hide(); });
      }

    });
  }


  /*Event listener functions*/
  // search function
  $('#search').keyup(function(e) {
    update_section_list($(e.target).val());
  });

  // focus effect
  $('#list_bar li a').on('click', function(e) {
    var $section = $(e.target.href.match(/#([A-Z])(_([a-z]+))?/)[0]);

    (function() {
      if (!$section[0].style.boxShadow) $section[0].style.boxShadow = "#ccc 0 0 1px";

      var depth = parseInt($section[0].style.boxShadow.match(/([0-9]*)px$/)[1]) + 5;

      // shadow on
      if (depth < 70) {
        $section.css('box-shadow', ' #ccc 0 0 '+ depth +'px');
        _.delay(arguments.callee, 30);
      }
      else {
        $section.css('box-shadow', '#ccc 0 0 '+ depth +'px');
        // shadow off
        (function() {
          var depth = parseInt($section[0].style.boxShadow.match(/([0-9]*)px$/)[1]) - 10;
          if (depth > 0) {
            $section.css('box-shadow', '#ccc 0 0 '+ depth +'px');
            _.delay(arguments.callee, 30);
          } else {
            $section.css('box-shadow', '#ccc 0 0 0px');
          }
        })();
      }
    })();

  });

</script>
</body>
</html>