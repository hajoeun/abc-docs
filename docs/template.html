<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TRY H</title>
  <link rel="stylesheet" href="lib/stylesheet/template.css">
  <link rel="stylesheet" href="lib/stylesheet/customize.css">
</head>
<body>

<script src="//rawgit.com/marpple/abc-functional-javascript/master/etc/abc.all.js"></script>
<script src="//rawgit.com/marpple/abc-functional-javascript/master/example/js/underscore.js"></script>
<script src="//code.jquery.com/jquery-2.2.4.min.js"></script>
<script>

  var examples = [
    "C(H('','\n\
    div\n\
      h1#hello Hello H template!\n\
      a[href=https://www.marpple.com] Marpple Go!\n\
      h3[style=\"color:red\"] 나는 한정판이다.'));",
    "C(H('','\n\
    textarea\n\
      |동해물과 백두산이\n\
      |마르고 닳도록\n\
    textarea.\n\
      \n\
      애국가를 입력해주세요.\n\
    span 오구야'));",
    "C(person, H('user','\n\
          div.!{user.company}!\n\
            h3 My name is {{user.name}}\n\
            h3 {{user.age}} years old.\n\
            h5 {{user.comment}}\n\
            h5 {{{user.comment}}}\n\
          '));",
    "C(H('','\n\
            h3 I am smart.\n\
//            h3 I am dummy.\n\
            h3 I like cheeseburger\n\
/*          h3 and pizza\n\
            h3 and chicken\n\
            h3 and french-fried\n\
            h3 and.. every food*/\n\
            h4 I am honest.\n\
            '));",
    "C(songs, H('songs', '\n\
      h3 Sing Street OST\n\
      ul\n\
        {{{C(songs, ', function (songs) {*\\n\
          return _.map(songs, function (song, i) {*\\n\
            return '<li>' + (i + 1) + '. ' + song + '</li>';*\\n\
          }).join('');*\\n\
        }, ')}}}'))",
    "C(songs, H('songs', '\n\
      h3 Sing Street OST\n\
      ul\n\
        !{C(songs, ', H.each('song, i', '\n\
        li {{i+1}}. {{song}}'), ')}!'))",
    "C(post, S('p', \"update posts set body = '{{p.body}}' where id = {{p.id}};\"))"
  ];

  var ex_ary = [
    {
      title: "Basic",
      detail: "id, class, attribute",
      comment: "`H` 함수를 사용하여 id와 class 등 다양한 속성을 지정할 수 있습니다."
    },
    {
      title: "Paragraph",
      detail: "`.` 혹은 `|` 사용하기",
      comment: "`.` 혹은 `|` 를 사용하여 개행을 포함한 문단을 작성할 수 있습니다."
    },
    {
      title: "Data",
      detail: "`!{}!`, `<<>>`, `<<<>>>`",
      comment: "`!{}!`, `<<>>`, `<<<>>>`을 사용하여 데이터를 치환할 수 있습니다.",
      data: "var person = { name: 'Cojamm', age: 32, company: 'marpple', comment:'<em>하이</em>' };"
    },
    {
      title: "Comments",
      detail: "`//`, `/* */`",
      comment: "`//`와 `/* */`를 사용하여 주석 처리를 할 수 있습니다."
    },
    {
      title: "Function1",
      detail: "",
      comment: "`!{}!`, `<<>>`, `<<<>>>`을 사용하여 함수를 실행할 수 있습니다.",
      data:
"var songs = [*\\n\
    'The Riddle Of The Model',*\\n\
    'Up',*\\n\
    'To Find You',*\\n\
    'A Beautiful Sea',*\\n\
    'Drive It Like You Stole It',*\\n\
    'Up (Bedroom Mix)',*\\n\
    'Girls',*\\n\
    'Brown Shoes' ];"
    },
    {
      title: "Function2",
      detail: "`H.each`",
      comment: "",
      data:
"var songs = [*\\n\
    'The Riddle Of The Model',*\\n\
    'Up',*\\n\
    'To Find You',*\\n\
    'A Beautiful Sea',*\\n\
    'Drive It Like You Stole It',*\\n\
    'Up (Bedroom Mix)',*\\n\
    'Girls',*\\n\
    'Brown Shoes' ];"
    },
    {
      title: "S",
      detail: "",
      comment: "`S` 함수는 `H` 템플릿 함수와 비슷하나, SQL문과 같은 일반 문자열을 다룰 때 사용 할 수 있습니다.",
      data: "var post = {id: 5, body: 'foo bar'}"
    }
  ];

  C([H('','\
    div.container#try_H\
      h1 TRY H\
      div.try_sections\
        {{{C(ex_ary, ', H.each('ex', '\
        div.section.!{ex.title}!#_!{ex.title}!\
          div.section_header\
            h2 {{ex.title}} <span class=detail>{{ex.detail}}</span>\
            p \
              |{{ex.comment}}\
          div.section_body.!{ex.title}!\
            div.s_test\
              h3 Test Code\
                button.btn.run_btn[title="Ctrl + Enter"].!{ex.title}!#!{ex.title}! Run\
              textarea.input.data[!{ex.data ? void 0 : "hidden"}!] {{ex.data}}\
              textarea.input.code **here**\
            div.s_result\
              h3 Results\
              div.output.dom\
        '), ')}}}\
    div.left\
      div.sidebar\
        div.link\
          ul\            li\
              a[href=#_Basic] Basic\
            li \
              a[href=#_Paragraph] Paragraph\
            li \
              a[href=#_Data] Data\
            li \
              a[href=#_Comments] Comments\
            li \
              a[href=#_Function1] Function1\
            li \
              a[href=#_Function2] Function2\
            li \
              a[href=#_S] S\
        div.setting\
          ul\
            li TAB size\
              form.tab_size\
                input#tab2[type=radio name="tab" value=2 checked]\
                  label[for=tab2] 2\
                input#tab4[type=radio name="tab" value=4]\
                  label[for=tab4] 4\
            li\
            li\
              button.btn["disabled"] Run \
              <small> `(Ctrl + Enter)`</small>\
        div.attr_info\
          ul \
            b Color Sheet\
            li\
            li.border-red .border-red\
            li.border-yellow .border-yellow\
            li.border-blue .border-blue\
            li.border-green .border-green\
            li\
            li.bg-red .bg-red\
            li.bg-yellow .bg-yellow\
            li.bg-blue .bg-blue\
            li.bg-green .bg-green\
            li\
            li#txt-white #txt-white\
            li#txt-black #txt-black\
    '),

    function(v) { // 이쁘게 출력
      var i = 0;
      return v.replace(/(&#x60;|`)(.*?)\1/g, "<code class='chip'>$2</code>")
              .replace(/&lt;&lt;&lt;(.*?)&gt;&gt;&gt;/g,'{{{$1}}}').replace(/&lt;&lt;(.*?)&gt;&gt;/g,'{{$1}}')
              .replace(/\*\*here\*\*/g, function() { return examples[i++].replace(/(\n)/g, '\\$1'); })
              .replace(/\*\\n/g, "\n");
    },
    $,
    B.M('appendTo', 'body')]);

  $('.tab_size').on('change', function(e) {                              // tab_size 변경 할 때에도 output 형태 업그레이드 해줘야 !!
    H.TAB_SIZE = C.parseInt($(':radio[name="tab"]:checked').val());

    C.each($('.section'), function(s) {
      var $code = $(s).find('.input.code');
      $code.val($code.val().replace(/ {2,}/g, function(m) {
        return H.TAB_SIZE == 4 ? m.replace(/  /g, "    ") : m.replace(/    /g, "  ");
      }));
    });

    console.log(H.TAB_SIZE + "%c tab 설정 완료!", "color:green;");
  });


  $('.run_btn').on('click', function(e) {

    var $section = $('.section' + '.' + e.target.id);
    var data = $section.find('.input.data').val(),
        code = $section.find('.input.code').val().replace(/;$/, "");

    try {
      $section.find('.dom')[0].innerHTML = (new Function(data + "; return (" + code + ");"))();
      console.log(e.target.id + "%c 코드 실행!", "color:green;");
      $section.find('.dom')[0].style.border = "2px solid #1abc9c";
    } catch (e) {
      console && console.error && console.error('Syntax Error...');
      $section.find('.dom')[0].innerHTML = e;
      $section.find('.dom')[0].style.border = "2px solid #e74c3c";
    }
  }).click();


  /*Key event handler*/
  var test;
  var keys = {};
  $('#try_H .input').keydown(function(e) {
    var T = H.TAB_SIZE == 2 ? "  " : "    ";

    keys[e.which] = true;

    if (keys[9]) { // tab was pressed
      var start = this.selectionStart;
      var end = this.selectionEnd;

      var $this = $(this);
      var value = $this.val();

      $this.val(value.substring(0, start) + T + value.substring(end));

      this.selectionStart = this.selectionEnd = start + H.TAB_SIZE;
      e.preventDefault();
    } else if (keys[13] && keys[17]) {
      $(e.target.parentNode.parentNode).find('.run_btn').click();
      delete keys[13]; delete keys[17];
    }

  });

  $('#try_H .input').keyup(function(e) { delete keys[e.which]; });
  $(document).keyup(function(e) { delete keys[e.which]; });
</script>









<script>

  function a() {
    return "asdf";
    sdfsd
  }

//  // 우리 코드 css 적용하는거
//  var $container = $('.container');
//  var $left = $('.left');
//  var $sections = $container.find('.section');
//
//  $('.chip').css({
//    'padding': '2px 4px',
//    'font-size': '90%',
//    'color': '#c7254e',
//    'background-color': '#f9f2f4',
//    'border-radius': '4px',
//    'font-family': 'Menlo, "Bitstream Vera Sans Mono", "DejaVu Sans Mono", Monaco, Consolas, monospace'
//  });
//
//  $('.btn').css({
//    'font-size': '13px',
//    'padding': '7px',
//    'color': '#fff',
//    'background-color': '#5cb85c',
//    'border-style': 'none',
//    'border-radius': '10%',
//    'outline': 'none',
//    'box-shadow': '#ccc 1px 3px 3px'
//  });
//
//
//  /*
//    left
//  */
//  $left.css({
//    'position': 'fixed',
//    'left': '0',
//    'top': '65px',
//    'bottom': '0',
//    'width': '250px'
//  });
//  $left.find('.link, .setting').css({
//    'margin': '0 auto auto 30px',
//    'background-color': 'white',
//    'box-shadow': '#ccc 0 0 3px'
//  });
//  $left.find('ul').css({
//    'font-size': '17px',
//    'list-style': 'none',
//    'padding': '15px 0'
//  });
//  $left.find('li').css({
//    'padding': '5px',
//    'padding-left': '20px'
//  });
//  $left.find('a').css({
//    'color': 'black',
//    'text-decoration': 'none'
//  });
//  $left.find('.tab_size').css({
//    'margin-left': '20px',
//    'display': 'inline-block'
//  });
//
//  $left.find('.link li').hover(function() {
//    $(this).css('background-color', 'whitesmoke');
//  }, function() {
//    $(this).css('background-color', 'white');
//  });
//
//
//
//  /*
//   container
//  */
//  $container.css({
//    'position': 'absolute',
//    'bottom': '0',
//    'top': '0',
//    'left': '0',
//    'right': '0',
//    'margin': '0',
//    'padding-left': '280px',
//    'overflow': 'auto'
//  });
//  $container.find('.btn').hover(function() {
//    $(this).css({
//      'background-color': '#449d44',
//      'box-shadow': '#ccc 0px 0px 0px'
//    });
//  }, function() {
//    $(this).css({
//      'background-color': '#5cb85c',
//      'box-shadow': '#ccc 1px 3px 3px'
//    });
//  });
//
//  $sections.css({
//    'padding': '5px 20px 5px 20px',
//    'margin': '0 30px 10px 0',
//    'box-shadow': '#ccc 0 0 3px',
//    'background-color': 'white',
//    'max-width': '1000px',
//    'overflow': 'auto'
//  });
//
//  $sections.find('.detail').css({
//    'font-size': '65%',
//    'color': '#777'
//  });
//
//
//  $sections.find('.s_test, s_result').css({
//    'display': 'inline-block'
//  });
//
//  $sections.find('.s_result').css({
//    'float': 'right',
//    'width': '45%'
//  });
//  $sections.find('.s_test').css({
//    'float': 'left',
//    'width': '54%'
//  });
//  $sections.find('.s_test h3').css({
//    'padding-right': '20px'
//  });
//
//  $sections.find('.input').css({
//    'cursor': 'text',
//    'font-size': '15px',
//    'font-family': 'Menlo, "Bitstream Vera Sans Mono", "DejaVu Sans Mono", Monaco, Consolas, monospace',
//    'width': '95%',
//    'margin': '0',
//    'color': 'whitesmoke',
//    'background-color': '#333333',
//    'resize': 'vertical'
//  });
//
//  $sections.find('.data').css('height', '100px');
//  $sections.find('.code').css({
//    'white-space': 'nowrap',
//    'height': '280px'
//  });
//  $sections.find('.run_btn').css('float', 'right');
//
//  $sections.find('.dom').css({
//    'width': '95%',
//    'margin': '0',
//    'min-height': '280px',
//    'border': '1px solid #ccc'
//  });
</script>


<script>
//  function TAB() { return "( {" + H.TAB_SIZE + "}|\\t)"; }; // "( {4}|\\t)"
//  function TABS() { return TAB() + "+"; };
//
//  function my_pretty(code) {
//    var T = (H.TAB_SIZE==2) ? '  ' : '    '; // 우리 페이지에선 2,4 두 경우밖에 없으니까
//
//    var stack = []; // tag_stack
//    var tab;
//
//    return code.replace(/<(\/?)(\w+)>/g, function(match, flag, tag) {
//      tab="";
//      if (flag) { // 닫는 태그
//
//        stack.pop(); // 돔에서 가져올꺼기 때문에 무조건 차례로 들어가있음 - 나중에 br같은건 걸러주기
//        for(var i=0; i<H.TAB_SIZE*stack.length; i++) tab+= T;
//        return '\n' + tab + match;
//
//      } else { // 여는 태그
//
//        for (var i=0; i<H.TAB_SIZE*stack.length; i++) tab+= T;
//        stack.push(tag);
//        return '\n' + tab + match + '\n' + tab + T ; // stack.length만큼의 탭 + match + '\n'
//      }
//    });
//  }


//    function my_pretty(code) {
//      var stack = []; // tag_stack
//
//      var r =  code.replace(/<(\/?)\w+>/g, function(match, flag) {
//        var tab="";
//        var res;
//        if (flag) { // 닫는 태그
//          stack.pop(); // 일단 잘 들어갔다는 가정 하 => 아님 다음 태그 닫힐 때까지 먹혔다가, 그때 닫아주어야 함
//          for(var i=0; i<H.TAB_SIZE*stack.length; i++) tab+= "  ";
//          res = '\n' + tab + match;
//
//        } else { // 여는 태그
//          for (var i=0; i<H.TAB_SIZE*stack.length; i++) tab+= "  ";
//          stack.push(1);
////                res = tab + match + '\n'; // stack.length만큼의 탭 + match + '\n'
////                res = '\n' + tab + match; // stack.length만큼의 탭 + match + '\n'
//          res = '\n' + tab + match + '\n' + tab + "  " ; // stack.length만큼의 탭 + match + '\n'
//        }
//        return res;
//      });
//      console.log(r);
//      return r.replace(/\n *\n/g, "\n");
//    }
//    $('textarea.output.html')[0].innerText = my_pretty($('.tttt')[0].outerHTML); // 이거!!!



    // 돔 통해서 만드는 거.. 아깝당
//    var str = "<div class='tttt'><span>스판1 <em>ㅋㅋㅋㅋㅋ</em></span><span>스판2 ㅋㅋㅋㅋㅋ</span></div>"
//    $('body').append(str);
//
//    var s = "<div class='tttt'><span>스판1 <em>ㅋㅋㅋㅋㅋ</em></span><span>스판2 ㅋㅋㅋㅋㅋ</span></div>"
//    $('body').append(s);
//
//    function pretty(nodeList) { // 배열 형태
//      var res = '';
//      for(var i=0; i<nodeList.length; i++) {
//        for(var j=0; j<nodeList[i].length; j++) {
//          if (nodeList[i].childNodes[j].childNodes) res += pretty(nodeList[i]);
//          else res += nodeList[i].outerHTML
//        }
//        console.log(res);
//      }
//      return res;
//    }


    //    nodeList[0].childNodes[0].childNodes
    //    // 얘가 없으면
    //    nodeList[0].outerHTML // 얘를 출력
    //
    //
    //
    //    $('.tttt')[0].childNodes[0].childNodes[0].childNodes
    //    // 얘가 없으면
    //    $('.tttt')[0].childNodes[0].outerHTML // 얘를 출력
    //
    //
    //
    //
    //



//    //    console.log(my_pretty(str) + '\n\n');
//
//    $('body').append('<div class="result"></div>');
//    console.log($('.tttt')[0].childNodes[0]);
//    $('.result').append($('.tttt')[0].childNodes[0])
//
//    //    //        code = code.replace(/(<\w+ ?>)/, "$1\n"); // 여는 태그
    //    //        code = code.replace(/(<(\w+) ?[\s\S]*?>[\s\S]*?)(<\w+ ?[\s\S]*?>)/g, function(match, $1, $2, $3) { stack.push($2); return $1+"\n"+$3; }); // 여는 태그
    //    code = code.replace(/(<\w+ ?[\s\S]*?>)([\s\S])*/g, "$1\n$2"); // 여는 태그
    //    code = code.replace(/(<\/\w+>)/g, "$1\n"); // 닫는 태그
    //    console.log(stack)
    //    return code;


    /*
     function print_DOM(nodeList) { //배열형태
     console.log("들어옴", nodeList);
     //        if (!nodeList) return nodeList; //처음부터 자식노드가 없을 경우 - 마지막에 처리하기

     var res = "";
     for (var i=0; i<nodeList.length; i++) {
     //            res += nodeList[i].childNodes ? print_DOM(nodeList[i].childNodes) : nodeList[i];

     if (!_.isEmpty(nodeList[i].childNodes)) {
     console.log("childNodes가 있는 경우 ; ", nodeList[i], nodeList[i].childNodes);
     res += print_DOM(nodeList[i].childNodes);
     } else {
     console.log("childNodes가 없는 경우 ; ", nodeList[i], nodeList[i].childNodes, nodeList[i].outerHTML);
     console.log(" ========== ", nodeList[i]);
     //                return nodeList[i];
     res += "추가된!"+nodeList[i].outerHTML;
     //                console.log(" ========== ", res);
     }

     }
     return res;
     }


     function pretty_print1(nodeList) { // 안배열 형태 로 반드시!! 애초에 보내주기!!
     var res = '';
     if (nodeList.childNodes) {
     for (var i=0; i<nodeList.childNodes.length; i++) {
     res += pretty_print(nodeList.childNodes[i]);
     }
     } else {
     res += nodeList[0].outerHTML;
     }
     return res;
     }

     function pretty_print(nodeList, tab) { // 안배열 형태 로 반드시!! 애초에 보내주기!!
     tab = tab ? tab+'  ' : ''; // if (!tab) tab = '';
     var res = '';
     if (nodeList.childNodes) {
     for (var i=0; i<nodeList.childNodes.length; i++) {
     res += pretty_print(nodeList.childNodes[i], tab);
     }
     } else {
     res += nodeList[0].outerHTML;
     }
     return res;
     }
     */
</script> <!--my_pretty code-->
</body>
</html>